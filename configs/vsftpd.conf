# vsftpd.conf - Configuration sécurisée
# ------------------------------
# SÉCURITÉ NIVEAU 1 - Configuration de base
# Points de contrôle :
# ✓ Désactiver l'accès anonyme
# ✓ Activer le chroot jail
# ✓ Configurer les timeouts
# ------------------------------
listen=YES
listen_ipv6=NO
anonymous_enable=NO          # Critique : Toujours désactiver l'accès anonyme
local_enable=YES            # N'autoriser que les utilisateurs locaux
write_enable=YES            # Autoriser l'écriture pour les utilisateurs authentifiés
local_umask=022            # Permissions par défaut : 644 pour les fichiers

# ------------------------------
# SÉCURITÉ NIVEAU 2 - Isolation
# Points de contrôle :
# ✓ Configurer le chroot correctement
# ✓ Limiter les accès concurrents
# ✓ Gérer les timeouts
# ------------------------------
chroot_local_user=YES       # Isoler chaque utilisateur dans son répertoire
allow_writeable_chroot=YES  # Attention : Uniquement si nécessaire
pam_service_name=vsftpd     # Service d'authentification
userlist_enable=YES         # Utiliser une liste d'utilisateurs autorisés
userlist_deny=NO            # Mode whitelist : seuls les utilisateurs listés sont acceptés
tcp_wrappers=YES           # Contrôle d'accès supplémentaire

# Limites de connexion
max_clients=10             # Maximum de clients simultanés
max_per_ip=2              # Connexions maximum par IP
idle_session_timeout=600   # Déconnexion après 10 minutes d'inactivité
data_connection_timeout=120 # Timeout des transferts de données


# ------------------------------
# SÉCURITÉ NIVEAU 4 - Logs
# Points de contrôle :
# ✓ Activer les logs détaillés
# ✓ Configurer la rotation des logs
# ✓ Monitorer les accès
# ------------------------------
xferlog_enable=YES
xferlog_std_format=YES
xferlog_file=/var/log/vsftpd.log
dual_log_enable=YES       # Logs supplémentaires
log_ftp_protocol=YES      # Logger les commandes FTP

# ------------------------------
# CONFIGURATION PASSIVE
# Points de contrôle :
# ✓ Définir la plage de ports
# ✓ Configurer le pare-feu
# ✓ Vérifier l'adresse publique
# ------------------------------
pasv_enable=YES
pasv_min_port=30000
pasv_max_port=30100
pasv_address=${PUBLIC_IP}  # À remplacer par votre IP publique

# ------------------------------
# POINTS DE VÉRIFICATION FINALE
# 1. Vérifier l'isolation des utilisateurs
# 2. Tester les transferts passifs
# 3. Contrôler les logs
# ------------------------------